@using EGHeals.Application.Dtos.Users
@using EGHeals.Application.Features.Users.Commands.Login
@using EGHeals.Components.Models.ModalPopups
@using EGHeals.Models.Dtos.Users

@inject TaskHandlerService TaskHandlerService
@inject ISender sender

<EditForm Model="User" OnValidSubmit="OnValidSubmitHandler">
   <DataAnnotationsValidator/>
   <VerticalAlignmentWrapper>
        <TextInputUI FontAwesomeIcon="fa-solid fa-user" Label="Username*" Placeholder="Enter your username" @bind-Value="User.Username" ValidationFor="@(() => User.Username)" />
        <PasswordInputUI FontAwesomeIcon="fa-solid fa-lock-keyhole" Label="Password*" Placeholder="Enter your password" @bind-Value="User.Password" ValidationFor="@(() => User.Password)" />
        <MainButtonUI IsSubmit="true">Login</MainButtonUI>       
   </VerticalAlignmentWrapper>
</EditForm>

@code
{
    private LoginUserRequestDto User = new();

    [CascadingParameter] public ModalContext Modal { get; set; } = default!;

    private async Task OnValidSubmitHandler()
    {
        await TaskHandlerService.RunAsync(async () =>
        {
            var command = new LoginCommand(new LoginUserDto(User.Username, User.Password));

            var result = await sender.Send(command);
        }, 
        setLoading: Modal.StartLoading,
        stopLoading: Modal.StopLoading,
        setError : Modal.SetError,
        setSuccess: Modal.SetSuccess,
        SuccessMsg: "Hello");
    }

}
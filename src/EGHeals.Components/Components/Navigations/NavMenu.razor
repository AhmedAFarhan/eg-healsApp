@using EGHeals.Components.Models.Navigations

<div class="sidebar">

    <div class="sidebar__logo">
        <EGHealsLogoComponent/>
    </div>

    <nav>
        <!-- ========== List ============  -->
        <ul class="sidebar-list">
            @foreach (var navMenuItem in navMenuItems)
            {
                <NavMenuItemComponent NavMenuItem="@navMenuItem" OnItemClicked="@ItemClickedHandler" />
            }
        </ul>
    </nav>

</div>

@code{

    private List<NavMenuItem> navMenuItems = default!;

    private void ItemClickedHandler((NavMenuItem clickedItem, NavMenuItem? parentItem) data)
    {
        var (clickedItem, parentItem) = data;

        // Special case: toggle parent expansion if already active
        if (clickedItem.NavSubMenuItems is not null && clickedItem.IsActive)
        {
            clickedItem.IsExpanded = !clickedItem.IsExpanded;
            return;
        }

        DeactivateAll(navMenuItems);

        // Step 2: activate the clicked item
        clickedItem.IsActive = true;

        if (parentItem is null)
        {
            // top-level item
            clickedItem.IsExpanded = clickedItem.NavSubMenuItems is not null;
        }
        else
        {
            // child item ? also expand parent
            parentItem.IsActive = true;
            parentItem.IsExpanded = true;
        }
    }

    private void DeactivateAll(IEnumerable<NavMenuItem> items)
    {
        foreach (var item in items)
        {
            item.IsActive = false;
            item.IsExpanded = false;

            if (item.NavSubMenuItems is not null)
                DeactivateAll(item.NavSubMenuItems);
        }
    }

    protected override void OnInitialized()
    {
        navMenuItems = new List<NavMenuItem>()
        {
            new NavMenuItem { Address="/", Title="Home", Icon="fa-regular fa-flatbread-stuffed", IsActive = true},
            new NavMenuItem { Address="/", Title="Home2", Icon="fa-regular fa-flatbread-stuffed", Counter = 10 },
            new NavMenuItem
            {
                Address="#",
                Title="Home",
                Icon="fa-solid fa-house",
                NavSubMenuItems = new List<NavMenuItem>()
                {
                    new NavMenuItem { Address = "/", Title = "Item 1"},
                    new NavMenuItem { Address = "/", Title = "Item 2"},
                    new NavMenuItem { Address = "/", Title = "Item 3"}
                }
            },
            new NavMenuItem { Address="/", Title="Home3", Icon="fa-regular fa-flatbread-stuffed"},
            new NavMenuItem
            {
                Address="#",
                Title="Test",
                Icon="fa-solid fa-house",
                NavSubMenuItems = new List<NavMenuItem>()
                {
                    new NavMenuItem { Address = "/", Title = "Item 1"},
                    new NavMenuItem { Address = "/", Title = "Item 2"},
                    new NavMenuItem { Address = "/", Title = "Item 3", Counter = 150}
                }
            },
            new NavMenuItem { Address="/", Title="Home3", Icon="fa-regular fa-flatbread-stuffed"},
        };
    }
}